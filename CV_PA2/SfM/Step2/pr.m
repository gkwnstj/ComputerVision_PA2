clear all; clc;
%Q1 = [[0.8622697644623529,0.8337151444264447,0.927355162802449,0.11766848777646255,0.4464246049594378],[0.12109486594613117,0.47805291967618924,0.8331153468040371,0.12031292648707481,0.21525298038485496],[0.5882525860712705,0.01102175019709506,0.0722263501622491,0.7076364380496349,0.15401595525933665]];
%Q2 = [[0.35365927416459975,0.8896492708332822,0.936515182994966,0.2524406764749536,0.6164414146675893],[0.06943701533465563,0.09406426043878857,0.7654011487311554,0.39374629622099877,0.7603588696091899],[0.9826447497488494,0.2924409623698061,0.8744217979183748,0.3221246207134274,0.8818986950764454]];

Q1 = rand(3,5)
Q2 = rand(3,5)

Q1 = Q1'; % (5,3)
Q2 = Q2'; % (5,3)

Q = [Q1(:,1).*Q2(:,1) , ...
     Q1(:,2).*Q2(:,1) , ...
     Q1(:,3).*Q2(:,1) , ... 
     Q1(:,1).*Q2(:,2) , ...
     Q1(:,2).*Q2(:,2) , ...
     Q1(:,3).*Q2(:,2) , ...
     Q1(:,1).*Q2(:,3) , ...
     Q1(:,2).*Q2(:,3) , ...
     Q1(:,3).*Q2(:,3) ] ; 


[U,S,V] = svd(Q,0);
EE = V(:,6:9);
   
A = calibrated_fivepoint_helper( EE ) ;
A = A(:,1:10)\A(:,11:20);
M = -A([1 2 3 5 6 8], :);
   
M(7,1) = 1;
M(8,2) = 1;
M(9,4) = 1;
M(10,7) = 1;

[V,D] = eig(M );
SOLS =   V(7:9,:)./(ones(3,1)*V(10,:));

Evec = EE*[SOLS ; ones(1,10 ) ]; 
Evec = Evec./ ( ones(9,1)*sqrt(sum( Evec.^2)));

I = find(not(imag( Evec(1,:) )));
Evec = Evec(:,I);